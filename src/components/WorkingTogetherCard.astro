---
import { Picture } from 'astro:assets';
import defaultImage from '../assets/images/default.jpg';

export interface Props {
  name: string;
  picture: string; 
  excerpt: string;
  company: string;
  linkedin: URL;
  relationship: 'manager' | 'managed' | 'peer';
  readMoreLabel?: string;
}

const {
  name,
  picture,
  excerpt,
  company,
  linkedin,
  relationship,
  readMoreLabel = 'Read more',
} = Astro.props;

const imageMap = import.meta.glob('../assets/images/testimonials/*', { eager: true });
const resolveImage = (image) => {
  return image && imageMap[`../assets/images/testimonials/${picture}`]
    ? imageMap[`../assets/images/testimonials/${picture}`].default
    : null;
};
const imagePath = resolveImage(picture) || defaultImage;

const relationshipText =
  relationship === 'manager'
    ? 'Was my manager'
    : relationship === 'peer'
    ? 'Was my peer'
    : 'Was one of my direct reports';
---

<div class="card">
  <!-- Column A -->
  <div class="colA">
    <div class="identity">
      <div class="avatar">
        <Picture src={imagePath} alt={`Portrait of ${name}`} />
      </div>
      <div class="who">
        <h3 class="name">
          {name}
          <a class="linkedin" href={String(linkedin)} target="_blank" rel="noopener noreferrer"><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHg9IjBweCIgeT0iMHB4Igp3aWR0aD0iNTAiIGhlaWdodD0iNTAiCnZpZXdCb3g9IjAgMCA1MCA1MCIKc3R5bGU9IiBmaWxsOiMwMDAwMDA7Ij4gICAgPHBhdGggc3R5bGU9ImxpbmUtaGVpZ2h0Om5vcm1hbDt0ZXh0LWluZGVudDowO3RleHQtYWxpZ246c3RhcnQ7dGV4dC1kZWNvcmF0aW9uLWxpbmU6bm9uZTt0ZXh0LWRlY29yYXRpb24tc3R5bGU6c29saWQ7dGV4dC1kZWNvcmF0aW9uLWNvbG9yOiMwMDA7dGV4dC10cmFuc2Zvcm06bm9uZTtibG9jay1wcm9ncmVzc2lvbjp0Yjtpc29sYXRpb246YXV0bzttaXgtYmxlbmQtbW9kZTpub3JtYWwiIGQ9Ik0gOSA0IEMgNi4yNTA0ODM5IDQgNCA2LjI1MDQ4MzkgNCA5IEwgNCA0MSBDIDQgNDMuNzQ5NTE2IDYuMjUwNDgzOSA0NiA5IDQ2IEwgNDEgNDYgQyA0My43NDk1MTYgNDYgNDYgNDMuNzQ5NTE2IDQ2IDQxIEwgNDYgOSBDIDQ2IDYuMjUwNDgzOSA0My43NDk1MTYgNCA0MSA0IEwgOSA0IHogTSA5IDYgTCA0MSA2IEMgNDIuNjY4NDg0IDYgNDQgNy4zMzE1MTYxIDQ0IDkgTCA0NCA0MSBDIDQ0IDQyLjY2ODQ4NCA0Mi42Njg0ODQgNDQgNDEgNDQgTCA5IDQ0IEMgNy4zMzE1MTYxIDQ0IDYgNDIuNjY4NDg0IDYgNDEgTCA2IDkgQyA2IDcuMzMxNTE2MSA3LjMzMTUxNjEgNiA5IDYgeiBNIDE0IDExLjAxMTcxOSBDIDEyLjkwNDc3OSAxMS4wMTE3MTkgMTEuOTE5MjE5IDExLjMzOTA3OSAxMS4xODk0NTMgMTEuOTUzMTI1IEMgMTAuNDU5Njg3IDEyLjU2NzE3MSAxMC4wMTE3MTkgMTMuNDg0NTExIDEwLjAxMTcxOSAxNC40NjY3OTcgQyAxMC4wMTE3MTkgMTYuMzMzOTc3IDExLjYzMTI4NSAxNy43ODk2MDkgMTMuNjkxNDA2IDE3LjkzMzU5NCBBIDAuOTg4MDk4NzggMC45ODgwOTg3OCAwIDAgMCAxMy42OTUzMTIgMTcuOTM1NTQ3IEEgMC45ODgwOTg3OCAwLjk4ODA5ODc4IDAgMCAwIDE0IDE3Ljk4ODI4MSBDIDE2LjI3MzAxIDE3Ljk4ODI4MSAxNy45ODgyODEgMTYuMzk2MDgzIDE3Ljk4ODI4MSAxNC40NjY3OTcgQSAwLjk4ODA5ODc4IDAuOTg4MDk4NzggMCAwIDAgMTcuOTg2MzI4IDE0LjQxNDA2MiBDIDE3Ljg4NDU3NyAxMi41MTM4MzEgMTYuMTkwNDQzIDExLjAxMTcxOSAxNCAxMS4wMTE3MTkgeiBNIDE0IDEyLjk4ODI4MSBDIDE1LjM5MjIzMSAxMi45ODgyODEgMTUuOTQxOTcgMTMuNjEwMDM4IDE2LjAwMTk1MyAxNC40OTIxODggQyAxNS45ODk4MDMgMTUuMzQ4NDM0IDE1LjQ2MDA5MSAxNi4wMTE3MTkgMTQgMTYuMDExNzE5IEMgMTIuNjE0NTk0IDE2LjAxMTcxOSAxMS45ODgyODEgMTUuMzAyMjI1IDExLjk4ODI4MSAxNC40NjY3OTcgQyAxMS45ODgyODEgMTQuMDQ5MDgzIDEyLjE0MDcwMyAxMy43MzQyOTggMTIuNDYwOTM4IDEzLjQ2NDg0NCBDIDEyLjc4MTE3IDEzLjE5NTM5IDEzLjI5NTIyMSAxMi45ODgyODEgMTQgMTIuOTg4MjgxIHogTSAxMSAxOSBBIDEuMDAwMSAxLjAwMDEgMCAwIDAgMTAgMjAgTCAxMCAzOSBBIDEuMDAwMSAxLjAwMDEgMCAwIDAgMTEgNDAgTCAxNyA0MCBBIDEuMDAwMSAxLjAwMDEgMCAwIDAgMTggMzkgTCAxOCAzMy4xMzQ3NjYgTCAxOCAyMCBBIDEuMDAwMSAxLjAwMDEgMCAwIDAgMTcgMTkgTCAxMSAxOSB6IE0gMjAgMTkgQSAxLjAwMDEgMS4wMDAxIDAgMCAwIDE5IDIwIEwgMTkgMzkgQSAxLjAwMDEgMS4wMDAxIDAgMCAwIDIwIDQwIEwgMjYgNDAgQSAxLjAwMDEgMS4wMDAxIDAgMCAwIDI3IDM5IEwgMjcgMjkgQyAyNyAyOC4xNzAzMzMgMjcuMjI2Mzk0IDI3LjM0NTAzNSAyNy42MjUgMjYuODA0Njg4IEMgMjguMDIzNjA2IDI2LjI2NDMzOSAyOC41MjY0NjYgMjUuOTQwMDU3IDI5LjQ4MjQyMiAyNS45NTcwMzEgQyAzMC40NjgxNjYgMjUuOTczOTgxIDMwLjk4OTk5OSAyNi4zMTE2NjkgMzEuMzg0NzY2IDI2Ljg0MTc5NyBDIDMxLjc3OTUzMiAyNy4zNzE5MjQgMzIgMjguMTY2NjY3IDMyIDI5IEwgMzIgMzkgQSAxLjAwMDEgMS4wMDAxIDAgMCAwIDMzIDQwIEwgMzkgNDAgQSAxLjAwMDEgMS4wMDAxIDAgMCAwIDQwIDM5IEwgNDAgMjguMjYxNzE5IEMgNDAgMjUuMzAwMTgxIDM5LjEyMjc4OCAyMi45NTQzMyAzNy42MTkxNDEgMjEuMzY3MTg4IEMgMzYuMTE1NDkzIDE5Ljc4MDA0NCAzNC4wMjQxNzIgMTkgMzEuODEyNSAxOSBDIDI5LjcxMDQ4MyAxOSAyOC4xMTA4NTMgMTkuNzA0ODg5IDI3IDIwLjQyMzgyOCBMIDI3IDIwIEEgMS4wMDAxIDEuMDAwMSAwIDAgMCAyNiAxOSBMIDIwIDE5IHogTSAxMiAyMSBMIDE2IDIxIEwgMTYgMzMuMTM0NzY2IEwgMTYgMzggTCAxMiAzOCBMIDEyIDIxIHogTSAyMSAyMSBMIDI1IDIxIEwgMjUgMjIuNTYwNTQ3IEEgMS4wMDAxIDEuMDAwMSAwIDAgMCAyNi43OTg4MjggMjMuMTYyMTA5IEMgMjYuNzk4ODI4IDIzLjE2MjEwOSAyOC4zNjkxOTQgMjEgMzEuODEyNSAyMSBDIDMzLjU2NTgyOCAyMSAzNS4wNjkzNjYgMjEuNTgyNTgxIDM2LjE2Nzk2OSAyMi43NDIxODggQyAzNy4yNjY1NzIgMjMuOTAxNzk0IDM4IDI1LjY4ODI1NyAzOCAyOC4yNjE3MTkgTCAzOCAzOCBMIDM0IDM4IEwgMzQgMjkgQyAzNCAyNy44MzMzMzMgMzMuNzIwNDY4IDI2LjYyNzEwNyAzMi45OTAyMzQgMjUuNjQ2NDg0IEMgMzIuMjYwMDAxIDI0LjY2NTg2MiAzMS4wMzE4MzQgMjMuOTgzMDc2IDI5LjUxNzU3OCAyMy45NTcwMzEgQyAyNy45OTU1MzQgMjMuOTMwMDAxIDI2Ljc0NzUxOSAyNC42MjY5ODggMjYuMDE1NjI1IDI1LjYxOTE0MSBDIDI1LjI4MzczMSAyNi42MTEyOTMgMjUgMjcuODI5NjY3IDI1IDI5IEwgMjUgMzggTCAyMSAzOCBMIDIxIDIxIHoiIGZvbnQtd2VpZ2h0PSI0MDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiB3aGl0ZS1zcGFjZT0ibm9ybWFsIiBvdmVyZmxvdz0idmlzaWJsZSI+PC9wYXRoPjwvc3ZnPg==" alt="visit {name} profile"></a>
        </h3>
        <p class="meta">{relationshipText} at <strong>{company}</strong></p>
      </div>
    </div>
  </div>

  <!-- Column B -->
  <div class="colB">
    <p class="excerpt">“{excerpt}”</p>

    <details class="expand">
      <summary class="button">{`Read more from ${name}`} </summary>
      <div class="more">
        <slot />
      </div>
    </details>
  </div>
</div>

<style>
  /* Card as a 2-col row */
  .card {
    display: grid;
    grid-template-columns: 1fr; /* Column A | Column B */
    gap: 1.25rem;
    align-items: start;
    margin-bottom: 2rem;
  }

  /* Column A content */
  .identity {
    display: grid;
    grid-template-columns: 100px 1fr;
    gap:1rem;
    align-items: center;
  }

  .avatar picture, .avatar img {
    display: block;
    width: 100px;
    height: 100px;
    object-fit: cover;
    border-radius: 100%;
  }

  .who .name {
    margin: 0 0 0.125rem 0;
    font-size: 1.2rem;
    line-height: 2rem;
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
    align-items: baseline;
  }

  .linkedin img {
      width:1.5rem;
      margin-bottom:-.3rem;
      filter: var(--color-filter);
    }


  /* Column B content */
  .excerpt {
    margin: 0;
    font-style: italic; 
  }

  .expand {
    margin-top: 0.75rem;
  }

  .expand summary {
    font-size:.7rem;
  }


  /* Responsive: stack on small screens */
  @media (min-width: 720px) {
    .card {
      grid-template-columns: 1fr 1fr; /* one column */
    }
    .excerpt {
      font-size: 1.125rem;
    }
  }
</style>
